<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: chess-game.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: chess-game.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * New node file
 */
var board, game = new Chess(), statusEl = $('#status'), fenEl = $('#fen'), pgnEl = $('#pgn'),player_color_dis = $("#piece_color"), options = {
	onThisClientJoinGame : userJoin,// User joins lobby
	onRecievePacket : updateOnlineBoard, // User recieves data packet
	onGameStart : gameStart,// Lobby is full, user can begin game
	connectionStatus : connectionSuccess, // Connection has been made successfully
	onOtherUserDisconnect : null
};

var player_color,player_color_regex,
game_started=false;

online_chess = $.fn.ClientGame("localhost:3000", 3, options);

// Connect to the server
online_chess.connectToServer();
online_chess.joinGame("Player Joined");

function userJoin(msg){
	
}

function gameStart(message){
	game_started = true;
	if(message.msg.player === 1){
		player_color = 'w';
		player_color_regex = /^b/;
		player_color_dis.html("White");
	}else{
		player_color = 'b';
		player_color_regex = /^w/;
		player_color_dis.html("Black");
	}
	alert("Game Start");
}

function connectionSuccess(msg){
	$(".circle").toggleClass("connected");
	$(".circle").toggleClass("disconnected");
}

//Update the users board from the other persons game
function updateOnlineBoard(message) {
	//Reload the board
	board.position(message.msg.board);
	game.load(message.msg.board);
	var status = check_game_status();

	statusEl.html(status);
	fenEl.html(game.fen());
	pgnEl.html(game.pgn());
};

// do not pick up pieces if the game is over
// only pick up pieces for the side to move
var onDragStart = function(source, piece, position, orientation) {
	var temp = piece.search(player_color_regex);
	if (game.game_over() === true 
			|| !game_started
			|| game.turn() !== player_color
			|| (game.turn() === player_color &amp;&amp; piece.search(player_color_regex) !== -1)) {
		return false;
	}
};

var onDrop = function(source, target) {
	// see if the move is legal
	var move = game.move({
		from : source,
		to : target,
		promotion : 'q' // NOTE: always promote to a queen for example
						// simplicity
	});

	// illegal move
	if (move === null)
		return 'snapback';

	updateStatus();
};

// update the board position after the piece snap
// for castling, en passant, pawn promotion
var onSnapEnd = function() {
	board.position(game.fen());
	var current_board = {
			'board' : game.fen()
		};
		
		online_chess.passGameData(current_board);
};



var check_game_status = function() {
	var status='';
	var moveColor = 'White';

	if (game.turn() === 'b') {
		moveColor = 'Black';
	}

	// checkmate?
	if (game.in_checkmate() === true) {
		status = 'Game over, ' + moveColor + ' is in checkmate.';
	}
	// draw?
	else if (game.in_draw() === true) {
		status = 'Game over, drawn position';
	}
	// game still on
	else {
		status = moveColor + ' to move';

		// check?
		if (game.in_check() === true) {
			status += ', ' + moveColor + ' is in check';
		}
	}
	return status;
}

var updateStatus = function() {
	var status = '';
	

	status = check_game_status();

	statusEl.html(status);
	fenEl.html(game.fen());
	pgnEl.html(game.pgn());
};

var cfg = {
	draggable : true,
	position : 'start',
	onDragStart : onDragStart,
	onDrop : onDrop,
	onSnapEnd : onSnapEnd
};
board = ChessBoard('board', cfg);

updateStatus();</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="$.fn.ClientGame.html">ClientGame</a></li></ul><h3>Global</h3><ul><li><a href="global.html#board">board</a></li><li><a href="global.html#user_letter">user_letter</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Mon Mar 07 2016 14:08:02 GMT-0800 (Pacific Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
