/**
 * Contains functions for the socket
 */
var number_in_room =0;
var room_number = 0;
module.exports = function (io) {
	
	io.sockets.on('connection', function(socket) {
    
    if(number_in_room >=2){
    	room_number++;
    }
    
    socket.join(room_number)
    number_in_room++;
    io.to(room_number).emit('user connect', { 'msg':"User Connected"});
    
    
    socket.on('disconnect', function(){
	    console.log('user disconnected');
	    io.to(0).emit('user connect', { 'msg':"User Disconnected" , 'for': 'everyone' });
	  });
    
    socket.on('chat message',function(msg){
    	var rooms = socket.adapter.rooms;
    	rooms = find_room_by_socket_id(socket.id,rooms);
    	
    	io.to(rooms[0]).emit('chat message', { 'msg':msg.msg, 'for': 'everyone' });
    });
  });
	
	
	function find_room_by_socket_id(socket_id,rooms){
		var socket_list;
		return rooms.map(function(room,index,array){
		socket_list = room.sockets.map(
		function(socket,index,array){
			if(socket_id == socket){
				return socket;
			}
				
		}
		
		);
		
			if(room.length > 1 && socket_list >0){
			return array[index];
			}
		});
	}
	
	
};